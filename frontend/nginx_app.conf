# Configuration Nginx pour EcoRide sur Heroku
server {
    listen $PORT;
    
    root /app/frontend;
    index pages/public/index.html;
    
    # Forcer HTTPS
    if ($http_x_forwarded_proto != "https") {
        return 301 https://$host$request_uri;
    }
    
    # En-têtes de sécurité pour éviter les redirections non désirées
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # Redirection de / vers /pages/public/index.html
    location = / {
        return 301 /pages/public/index.html;
    }
    
    # Servir les fichiers statiques
    location /assets/ {
        access_log off;
        expires 30d;
        add_header Cache-Control "public, max-age=2592000";
    }
    
    # Gestion des pages HTML - PAS de fallback vers index.html
    location /pages/ {
        try_files $uri $uri.html $uri/ =404;
    }
    
    # Gestion des erreurs
    error_page 404 /pages/public/error.html;
} 